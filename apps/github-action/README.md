# lazypr AI PR Summary

![Tests](https://github.com/your-username/lazypr/actions/workflows/test.yml/badge.svg)
![Release](https://github.com/your-username/lazypr/actions/workflows/release.yml/badge.svg)
![Node](https://img.shields.io/node/v20)

Automatically generate AI-powered PR summaries with impact scoring, Ghost Commit detection, and automated reviewer checklists.

## Features

- **AI-Powered Summaries**: Uses OpenAI or Anthropic to generate meaningful PR descriptions
- **Impact Scoring**: Automatically assesses risk based on changed files (auth, schema, etc.)
- **Ghost Commit Detection**: Identifies commits where the message doesn't match the changes
- **Reviewer Checklists**: Generates context-aware checklist items based on the code changes
- **Risk Labels**: Adds `lazypr/high-risk`, `lazypr/medium-risk`, or `lazypr/low-risk` labels
- **Custom Templates**: Supports loading custom prompt templates from your repository

## Usage

### Basic Setup

Add this to your workflow file (e.g., `.github/workflows/pr-summary.yml`):

```yaml
name: AI PR Summary
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  summarize:
    runs-on: ubuntu-latest
    steps:
      - uses: your-username/lazypr@v1
        with:
          api_key: ${{ secrets.OPENAI_API_KEY }}
```

### With All Options

```yaml
name: AI PR Summary
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  summarize:
    runs-on: ubuntu-latest
    steps:
      - uses: your-username/lazypr@v1
        with:
          api_key: ${{ secrets.OPENAI_API_KEY }}
          provider: openai  # or anthropic
          model: gpt-4-turbo
          template: default  # default, concise, verbose, security-focused
          custom_template: true  # enable loading .github/lazypr-template.md
```

## Inputs

| Input | Required | Default | Description |
|-------|----------|---------|-------------|
| `api_key` | Yes | - | OpenAI or Anthropic API key |
| `provider` | No | `openai` | LLM provider (`openai` or `anthropic`) |
| `model` | No | `gpt-4-turbo` | Model to use |
| `template` | No | `default` | Template name (`default`, `concise`, `verbose`, `security-focused`) |
| `custom_template` | No | `false` | Whether to load custom template from repo |
| `github_token` | Yes | `${{ github.token }}` | GitHub token for API access |

## Outputs

| Output | Description |
|--------|-------------|
| `summary` | Generated PR summary |
| `has_ghost_commits` | Whether ghost commits were detected |
| `risk_level` | Risk level (`LOW`, `MEDIUM`, `HIGH`) |
| `impact_score` | Impact score (0-100) |

## Templates

### Built-in Templates

1. **default**: Standard PR summary with risk assessment and checklist
2. **concise**: Brief summary only, minimal output
3. **verbose**: Detailed analysis with file breakdown
4. **security-focused**: Emphasizes security implications

### Custom Templates

Enable custom templates by setting `custom_template: true`. The action will look for:

- `.github/lazypr-template.md`
- `.lazypr/template.md`
- `lazypr-template.md`

Template placeholders:
- `{{diff}}` - The git diff
- `{{filesChanged}}` - List of changed files
- `{{prTitle}}` - PR title
- `{{prBody}}` - PR body/description
- `{{prAuthor}}` - PR author username
- `{{riskLevel}}` - Risk level (LOW/MEDIUM/HIGH)
- `{{riskScore}}` - Impact score (0-100)
- `{{highRiskFiles}}` - List of high-risk files
- `{{fileBreakdown}}` - Summary of file risk breakdown

## Risk Assessment

Files are categorized as:

- **HIGH RISK**: auth, schema, migrations, permissions, secrets, API keys
- **MEDIUM RISK**: controllers, services, routes, API endpoints
- **LOW RISK**: tests, configs, documentation

## Example Output

```markdown
## ðŸš€ PR Summary: Add user authentication

This PR implements JWT-based authentication for the API...

### Risk Assessment: ðŸŸ¡ MEDIUM (Score: 65/100)

### Reviewer Checklist
- [ ] Test authentication flow end-to-end
- [ ] Verify authorization checks
- [ ] Update API documentation

---
*Generated by lazypr at 2024-01-16T12:00:00Z*
```

## Environment Variables

Add your API key as a secret:

1. Go to your repository Settings > Secrets and variables > Actions
2. Add `OPENAI_API_KEY` or `ANTHROPIC_API_KEY`

## Contributing

See [CONTRIBUTING.md](./CONTRIBUTING.md) for details.

## License

MIT License - see [LICENSE](./LICENSE) for details.
