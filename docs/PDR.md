# Product Design Document: LazyPR

## 1. Executive Summary

**LazyPR** is an open-source GitHub Action that automatically generates high-quality Pull Request descriptions. It analyzes git diffs (and selected commit history signals) using a user-provided LLM API key to provide context-aware summaries, impact assessments, and reviewer checklists.

## 2. Problem Statement

- **Lazy Documentation:** Developers often write vague PR descriptions ("fixes bug," "stuff"), forcing reviewers to waste time deciphering the code.
- **Context Loss:** Over time, the "Why" behind a change is lost because the PR history is uninformative.
- **Reviewer Fatigue:** Large PRs are difficult to parse without a structured breakdown of changes.

---

## 3. Product Features

### Core Functionality

- **Automated Summarization:** Generates a "TL;DR" for every PR.
- **File-by-File Analysis:** Breaks down changes by module or file group.
- **Git Diff Synthesis:** Summarizes the actual logic changes, not just the commit messages (which may be inaccurate).
- **Bring-Your-Own-Key (BYOK):** Supports OpenAI, Anthropic, and local LLM endpoints via environment variables.

### The "Unique Edge" Features (Differentiators)

- **Impact Scoring:** Uses AI to categorize the PR as `Low`, `Medium`, or `High` risk based on the sensitivity of files changed (e.g., changes to `auth.js` or `database/schema` trigger high risk).
- **"Ghost" Commit Detection:** Identifies discrepancies where a commit message says one thing (e.g., "Refactor UI") but the code actually does another (e.g., "Deleted API endpoint").
- **Custom Prompt Templates:** Allows teams to check in a custom template file (e.g. `.github/lazypr-template.md`) to force the AI to follow a specific team-defined voice or format.
- **Automated Reviewer Checklist:** Generates a tailored checklist for the reviewer (e.g., "Ensure you check the migration script for data loss" if the AI detects SQL changes).
- **Visual Diff Map:** Uses Markdown tables to show "Before" vs "After" logic flow for complex functions.

---

## 4. Technical Architecture

### Component Overview

| Component                 | Responsibility                                                                     |
| ------------------------- | ---------------------------------------------------------------------------------- |
| **GitHub Action Wrapper** | Handles the trigger event (`pull_request.opened`, `synchronize`).                  |
| **Context Engine**        | Extracts `git diff`, `git log`, and `PR metadata` using the GitHub REST API.       |
| **Prompt Orchestrator**   | Sanitizes the diff (removes lockfiles/minified code) and constructs the AI prompt. |
| **AI Connector**          | Communicates with the user-defined API (OpenAI/Anthropic).                         |
| **PR Updater**            | Posts or edits the PR description with the generated Markdown.                     |

### Logic Flow

1. **Trigger:** PR created or code pushed.
2. **Filter:** Action ignores `node_modules`, `package-lock.json`, and images to save tokens.
3. **Analyze:** Diff is truncated to fit context windows; core logic changes are prioritized.
4. **Generate:** AI processes the diff against the team's template.
5. **Post:** The PR body is updated with a "Generated by AutoPR" footer.

---

## 5. User Experience (UX)

### User Setup

The user adds a `.github/workflows/lazypr.yml` file to their repo:

```yaml
name: AutoPR Summary
on: [pull_request]
jobs:
  summarize:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: elvis-ndubuisi/lazypr@v1
        with:
          api_key: ${{ secrets.GEMINI_API_KEY }}
          provider: gemini
          template: default
          custom_template: true
          custom_template_path: ".github/my-custom-prompt.md"
```

### The Output (The PR Body)

> ## ðŸš€ PR Summary: "Refactor User Auth"
>
> **TL;DR:** Switched from JWT to Session-based auth to improve security.
>
> ### ðŸ›  Key Changes
>
> - **Auth Engine:** Replaced `jsonwebtoken` with `express-session`.
> - **Database:** Added `sessions` table to schema.
>
> ### âš ï¸ Risk Assessment: HIGH
>
> - This PR modifies the login flow. Ensure the session timeout is configured for production.
>
> ### ðŸ•µï¸ Reviewer Checklist
>
> - [ ] Verify session store cleanup.
> - [ ] Test "Remember Me" cookie persistence.

---

## 6. Success Metrics

- **Review Velocity:** Reduction in time from "PR Opened" to "Approved."
- **Comment Quality:** Fewer "What does this do?" comments from reviewers.
- **Token Efficiency:** Providing the highest quality summary with the smallest possible diff-snippet.
